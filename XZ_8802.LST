C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE XZ_8802
OBJECT MODULE PLACED IN XZ_8802.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE XZ_8802.c LARGE OPTIMIZE(0,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1                                                                                                                            /*Èç¹ûRST¹Ü½Å½ÓMCUµÄÍ¨ÓÃIO½Å,Çë²Î¿¼ÏÂÃæµÄ½Ó¿Ú³ÌĞò*/
   2          /* MCU³ÌĞò³õÊÔ»¯Ê±Ó¦ÉèÖÃIC_IOÎªÊäÈë,IC_IO×îºÃÉè³Éopen-drainÄ£Ê½¡£*/
   3          /* ²Î¿¼´úÂëÊÇ»ùÓÚ51µ¥Æ¬»úµÄ,ÆäËüĞÍºÅµÄMCUĞèÒªÕıÈ·ÉèÖÃIC_IOµÄÊäÈë/Êä³ö·½Ïò¡£*/
   4          /*Çë°´ÕÕ²Î¿¼´úÂëÖĞµÄÌáÊ¾Î»ÖÃ½øĞĞÉèÖÃ£¬¼´ÔÚSendComm()º¯Êı¿ªÊ¼µÚ3ĞĞ´¦£¬ĞèÒª°ÑMCUµÄIC_IO·½ÏòÉèÎªÊä³ö£¨×îºÃÉè³
             -Éopen-drain¿ªÂ©Êä³ö£©£»ÔÚSendComm()º¯Êı×îºó£¬ĞèÒª°ÑMCUµÄIC_IO·½ÏòÉèÎªÊäÈë£»*/
   5          /*ÔÚResetCard()¡¢BreakOperate()ÕâÁ½¸öº¯Êı¿ªÊ¼£¬ĞèÒª°ÑMCUµÄIC_IO·½ÏòÉèÎªÊäÈë£¬·ñÔò»áµ¼ÖÂµçÆ½³åÍ»¶ø³ö´í¡£MCU
             -µÄIC_CLK¡¢IC_RST·½ÏòÒ»Ö±ÊÇÊä³ö¡£*/
   6          
   7          #include "XZ_8802.h"
   8          
   9          
  10          static void ChangeKey(void);
  11          
  12          unsigned char 
  13          Verify8802(void)
  14          {
  15   1              int i=0;
  16   1              int returnvalue;
  17   1              unsigned char idata key[3]={0x1a,0x5e,0xbc};//ÃÜÂëÉè¶¨´¦        
  18   1      
  19   1              uchar idata id_read=0x01; //Êµ¼Ê¶Á³öµÄ³§ÉÌ±êÊ¾ºÅ
  20   1              
  21   1      
  22   1              ReadMainMem(0x08, &id_read,1);
  23   1              if(id_read != 0x68)
  24   1              {
  25   2                      returnvalue=0;
  26   2              }
  27   1      
  28   1              if(Verify(key))
  29   1                      {
  30   2              //              ChangeKey();//ĞŞ¸ÄÃÜÂë
  31   2                              returnvalue=1;  
  32   2                      }
  33   1              else 
  34   1                      returnvalue=0;
  35   1              return returnvalue;
  36   1      }
  37          
  38          /*********************************************************************  
  39          
  40          º¯ Êı Ãû: ReadMainMem()
  41          ¹¦    ÄÜ: ¶ÁXZ8802Ö÷´æ
  42          Ëµ    Ã÷: 
  43          µ÷    ÓÃ: 
  44          È«¾Ö±äÁ¿:
  45          Èë¿Ú²ÎÊı: XZ8802µØÖ·(32 - 255),Ö¸ÏòÄÚ²¿RAMµÄÖ¸Õë,×Ö½ÚÊı
  46          ³ö¿Ú²ÎÊı£ºÖ¸ÏòÄÚ²¿RAMµÄÖ¸Õë *pt
  47          ·µ »Ø Öµ: ÎŞ
  48          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
  49          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
  50          *********************************************************************/
  51          void ReadMainMem(uchar addr,uchar idata *pt,uchar count)
  52          {
  53   1          ResetCard();
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 2   

  54   1          SendComm(RMM_COMM,addr,0xff);       //µÚ3¸ö²ÎÊıÔÚ´ËÃüÁîÖĞ±»ºöÂÔ£¬¿ÉÒÔÉè³ÉËæ»úÊı
  55   1          ReadMode(pt,count);
  56   1          //BreakOperate();
  57   1          ResetCard();        //1212
  58   1      }
  59          
  60          /*********************************************************************  
  61          
  62          º¯ Êı Ãû: Verify()
  63          ¹¦    ÄÜ: Ğ£ÑéÃÜÂë
  64          Ëµ    Ã÷: 
  65          µ÷    ÓÃ: 
  66          È«¾Ö±äÁ¿:
  67          Èë¿Ú²ÎÊı: Ö¸Ïò´æ·ÅÃÜÂëµÄÄÚ²¿Ö±½ÓÑ°Ö·RAMµØÖ·,
  68                     ÃÜÂë£ºBCD Âë,´ÓµÍÍù¸ß·Å£¬±ÈÈç£º114086  *pt = 0x11 *pt+1 = 0x40 *pt+2 = 0x86
  69          ³ö¿Ú²ÎÊı£ºÎŞ
  70          ·µ »Ø Öµ: ³É¹¦·µ»Ø1,Ê§°Ü·µ»Ø0,XZ8802ÒÑËøÒ²·µ»Ø0
  71          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
  72          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
  73          *********************************************************************/
  74          bit Verify(uchar idata *pt)
  75          {
  76   1           uchar idata temp[4];                //Ôİ´æ4×Ö½ÚµÄ±£ÃÜÇøÄÚÈİ
  77   1           uchar i;
  78   1           ResetCard();                       //edit 05
  79   1           SendComm(RSM_COMM,0xff,0xff);        //¶ÁÃÜÂë´æ´¢ÇøµÄÃüÁî×Ö,µÚ2,3¸ö²ÎÊıÔÚ´ËÃüÁîÖĞ±»ºöÂÔ£¬¿ÉÒÔÉè³ÉËæ»ú
             -Êı
  80   1           ReadMode(temp, 4);                   //¶Á³ö
  81   1           //if((temp[0] & 0x77) != 0)            //µÚÒ»×Ö½ÚÊÇ´íÎó¼ÆÊıÆ÷,Èç¹û´íÎó¼ÆÊıÆ÷Îª0,Ö±½ÓÍË³ö
  82   1           if((temp[0] & 0x77) != 0x04)            //µÚÒ»×Ö½ÚÊÇ´íÎó¼ÆÊıÆ÷,Èç¹û´íÎó¼ÆÊıÆ÷Îª04,Ö±½ÓÍË³ö//edit 06
  83   1           {
  84   2               if((temp[0] & 0x77)==0x77)     // 01110111
  85   2                      i = 0x67;               //½«ÆäÖĞÒ»Î»Îª1µÄ¸ÄÎª0
  86   2               else if((temp[0] & 0x77)==0x67)// 01100111 
  87   2                      i = 0x47;               //½«ÆäÖĞÒ»Î»Îª1µÄ¸ÄÎª0
  88   2               else if((temp[0] & 0x77)==0x47)// 01000111 
  89   2                      i = 0x07;               //½«ÆäÖĞÒ»Î»Îª1µÄ¸ÄÎª0
  90   2               else if((temp[0] & 0x77)==0x07)// 00000111 
  91   2                      i = 0x06;               //½«ÆäÖĞÒ»Î»Îª1µÄ¸ÄÎª0
  92   2               else if((temp[0] & 0x77)==0x06)// 00000110 
  93   2                      i = 0x04;               //½«ÆäÖĞÒ»Î»Îª1µÄ¸ÄÎª0
  94   2               //else if((temp[0] & 0x77)==0x04)// 00000100 //edit 06
  95   2               //          i = 0x00;               //½«ÆäÖĞÒ»Î»Îª1µÄ¸ÄÎª0 //edit 06
  96   2              SendComm(WSM_COMM,0,i);            //ĞŞ¸Ä´íÎó¼ÆÊıÆ÷
  97   2              ProcessMode();                  //´¦Àí
  98   2              for (i = 1; i < 4; i++, pt++)   //Ğ£¶Ô3×Ö½ÚµÄÃÜÂë
  99   2              {
 100   3                   SendComm(VER_COMM,i,*pt);  //·¢³öĞ£¶ÔÃüÁî,
 101   3                   ProcessMode();             //´¦Àí
 102   3              }
 103   2              //SendComm(WSM_COMM,0,0xff);      //²Á³ı¼ÆÊıÆ÷»Ö¸´´íÎó¼ÆÊıÆ÷
 104   2              SendComm(WSM_COMM,0,0x77);      //²Á³ı¼ÆÊıÆ÷»Ö¸´´íÎó¼ÆÊıÆ÷//2006-08-10
 105   2              ProcessMode();                  //´¦Àí
 106   2              SendComm(RSM_COMM,0xff,0xff);   //¶ÁÃÜÂë´æ´¢ÇøµÄÃüÁî×Ö,µÚ2,3¸ö²ÎÊıÔÚ´ËÃüÁîÖĞ±»ºöÂÔ£¬¿ÉÒÔÉè³ÉËæ»úÊı
 107   2              ReadMode(temp, 4);              //¶Á´íÎó¼ÆÊıÆ÷µÄÄÚÈİ
 108   2              //if((temp[0] & 0x07)==0x07)      //Èç¹ûÃ»ÓĞ±»³É¹¦²Á³ı,±íÃ÷Ğ£¶ÔÊ§°Ü
 109   2              if(temp[0]==0x77)      //Èç¹ûÃ»ÓĞ±»³É¹¦²Á³ı,±íÃ÷Ğ£¶ÔÊ§°Ü//2006-08-10
 110   2                   return 1 ;
 111   2           }
 112   1           return 0;
 113   1      }
 114          
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 3   

 115          /*********************************************************************  
 116          
 117          º¯ Êı Ãû: WriteMainMem()
 118          ¹¦    ÄÜ: Ğ´XZ8802Ö÷´æ,Ò»´Î 1Byte
 119          Ëµ    Ã÷: 
 120          µ÷    ÓÃ: 
 121          È«¾Ö±äÁ¿:
 122          Èë¿Ú²ÎÊı: addr: XZ8802µØÖ·(32 - 255), pt: Ö¸ÏòÊı¾İÇøµÄÖ¸Õë  i:×Ö½ÚÊı 
 123          ³ö¿Ú²ÎÊı£ºÎŞ
 124          ·µ »Ø Öµ: ÎŞ
 125          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 126          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 127          *********************************************************************/
 128          /*
 129          void WriteMainMem(uchar addr,uchar idata *pt)
 130          {
 131              ResetCard();
 132              SendComm(WMM_COMM, addr, *pt);     //Ğ´Ö÷´æµÄÃüÁî×Ö,µØÖ·,Êı¾İ
 133              ProcessMode();
 134              BreakOperate();    
 135          }
 136          */
 137          /*********************************************************************  
 138          
 139          º¯ Êı Ãû: ReadProtectMem()
 140          ¹¦    ÄÜ: ¶Á±£»¤´æ´¢Æ÷
 141          Ëµ    Ã÷: 
 142          µ÷    ÓÃ: 
 143          È«¾Ö±äÁ¿:
 144          Èë¿Ú²ÎÊı: Ö¸ÏòÖ±½ÓÑ°Ö·Êı¾İÇøµÄÖ¸Õë
 145          ³ö¿Ú²ÎÊı£ºÎŞ
 146          ·µ »Ø Öµ: ÎŞ
 147          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 148          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 149          *********************************************************************/
 150          /*
 151          void ReadProtectMem(uchar idata *pt)
 152          {
 153              ResetCard();    
 154              SendComm(RPM_COMM,0xff,0xff); //¶Á±£»¤´æ´¢Æ÷µÄÃüÁî×Ö,ºóÁ½¸ö²ÎÊıºöÂÔ£¬¿ÉÒÔÉè³ÉËæ»úÊı
 155              ReadMode(pt,4);               //¶Á³ö
 156              BreakOperate();        
 157          }
 158          */
 159          /*********************************************************************  
 160          
 161          º¯ Êı Ãû: ProtectByte()
 162          ¹¦    ÄÜ: ±£»¤Ò»×Ö½Ú,×¢Òâ´ı±£»¤µÄ×Ö½ÚÊÇÒÑ¾­Ğ´Èë¹ıµÄ,µØÖ·Ö»ÄÜÔÚ±£»¤´æ´¢ÇøÄÚ
 163          Ëµ    Ã÷: 
 164          µ÷    ÓÃ: 
 165          È«¾Ö±äÁ¿:
 166          Èë¿Ú²ÎÊı: XZ8802µØÖ·(0 ~ 31),Ö¸ÏòÖ±½ÓÑ°Ö·Êı¾İÇøµÄÖ¸Õë,ptÖ¸ÏòµÄÊı¾İÇøÓ¦´æ·Å±»±£»¤µÄÖ÷´æ´¢Æ÷×Ö½ÚÄÚÈİ¡£
 167          ³ö¿Ú²ÎÊı£ºÎŞ
 168          ·µ »Ø Öµ: ÎŞ
 169          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 170          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 171          *********************************************************************/
 172          /*
 173          void ProtectByte(uchar addr,uchar idata *pt)
 174          {
 175              ResetCard();
 176              SendComm(WPM_COMM, addr, *pt); //Ğ´±£»¤´æ´¢ÇøµÄÃüÁî×Ö,µØÖ·,Êı¾İ
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 4   

 177              ProcessMode();
 178              BreakOperate();            
 179          }
 180          */
 181          /*********************************************************************  
 182          
 183          º¯ Êı Ãû: SendComm()
 184          ¹¦    ÄÜ: ·¢ËÍÃüÁî
 185          Ëµ    Ã÷:
 186          µ÷    ÓÃ: 
 187          È«¾Ö±äÁ¿:
 188          Èë¿Ú²ÎÊı: a: ÃüÁî×Ö, b: µØÖ·, c: Êı¾İ
 189          ³ö¿Ú²ÎÊı£ºÎŞ
 190          ·µ »Ø Öµ: ÎŞ
 191          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 192          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 193          *********************************************************************/
 194          void SendComm(uchar a,uchar b,uchar c)
 195          {
 196   1              SFRPAGE = CONFIG_PAGE;
 197   1              IC_CLK_0;       //0115
 198   1          Delay5us(); //0115
 199   1          //ÈçMCU²»ÊÇ51ÏµÁĞ,ĞëÔÚ´Ë´¦ÉèÖÃMCUµÄIC_IO·½ÏòÎªÊä³ö!!£¨×îºÃÉè³Éopen-drain¿ªÂ©Êä³ö£©//0115 //0303
 200   1              
 201   1          Delay5us(); //0115
 202   1          StartComm();          //¿ªÊ¼·¢ËÍÃüÁî
 203   1      
 204   1          WriteByte(a);         //a: ·¢ÃüÁî×Ö
 205   1      
 206   1          WriteByte(b);          //b: ·¢µØÖ·
 207   1      
 208   1          WriteByte(c);          //c: ·¢Êı¾İ
 209   1          StopComm();           //½áÊø·¢ËÍÃüÁî
 210   1          //ÈçMCU²»ÊÇ51ÏµÁĞ,ĞëÔÚ´Ë´¦ÉèÖÃMCUµÄIC_IO·½ÏòÎªÊäÈë!!        //0115 //0218
 211   1          Delay5us(); //0218
 212   1      }
 213          /*********************************************************************  
 214          
 215          º¯ Êı Ãû: StartComm()
 216          ¹¦    ÄÜ: ¿ªÊ¼ÃüÁîÄ£Ê½
 217          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 218          µ÷    ÓÃ: 
 219          È«¾Ö±äÁ¿:
 220          Èë¿Ú²ÎÊı: ÎŞ
 221          ³ö¿Ú²ÎÊı£ºÎŞ
 222          ·µ »Ø Öµ: ÎŞ
 223          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 224          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 225          *********************************************************************/
 226          void StartComm(void)
 227          {
 228   1              SFRPAGE = CONFIG_PAGE;
 229   1          IC_CLK_0;
 230   1          IC_IO_1;
 231   1          Delay5us();
 232   1          IC_CLK_1;
 233   1          Delay5us();
 234   1          IC_IO_0;
 235   1          Delay5us();
 236   1      }
 237          /*********************************************************************  
 238          
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 5   

 239          º¯ Êı Ãû: StopComm()
 240          ¹¦    ÄÜ: ½áÊøÃüÁîÄ£Ê½
 241          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 242          µ÷    ÓÃ: 
 243          È«¾Ö±äÁ¿:
 244          Èë¿Ú²ÎÊı: ÎŞ
 245          ³ö¿Ú²ÎÊı£ºÎŞ
 246          ·µ »Ø Öµ: ÎŞ
 247          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 248          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 249          *********************************************************************/
 250          void StopComm(void)
 251          {
 252   1              SFRPAGE = CONFIG_PAGE;
 253   1          IC_CLK_0;
 254   1          IC_IO_0;
 255   1          Delay5us();
 256   1          IC_CLK_1;        //CLK: H
 257   1          Delay5us();
 258   1          IC_IO_1;        //IO : H
 259   1          Delay10us();
 260   1      }
 261          /*********************************************************************  
 262          
 263          º¯ Êı Ãû: ResetCard()
 264          ¹¦    ÄÜ: XZ8802¸´Î»ºÍ¸´Î»Ó¦´ğ
 265          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 266          µ÷    ÓÃ: 
 267          È«¾Ö±äÁ¿:
 268          Èë¿Ú²ÎÊı: ÎŞ
 269          ³ö¿Ú²ÎÊı£ºÎŞ
 270          ·µ »Ø Öµ: ÎŞ
 271          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 272          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 273          *********************************************************************/
 274          void ResetCard(void)
 275          {
 276   1              uchar temp=0; 
 277   1          Delay5us(); 
 278   1              SFRPAGE = CONFIG_PAGE;   
 279   1          IC_RST_0;        
 280   1          IC_CLK_0;     
 281   1          //ÈçMCU²»ÊÇ51ÏµÁĞ,ĞëÔÚ´Ë´¦ÉèÖÃMCUµÄIC_IO·½ÏòÎªÊäÈë!!        //0115
 282   1      
 283   1          IC_IO_1;  
 284   1          Delay5us();  
 285   1          
 286   1          IC_RST_1;
 287   1          Delay5us();
 288   1          IC_CLK_1;
 289   1          Delay10us();
 290   1          Delay10us();
 291   1          Delay10us();
 292   1          Delay10us();
 293   1          IC_CLK_0;
 294   1          Delay5us();
 295   1          IC_RST_0;
 296   1          Delay10us();     //¸´Î»ºÍ¸´Î»Ó¦´ğÊ±Ğò
 297   1                           //      ___
 298   1                           //RST _|   |_______________________   
 299   1                           //       _   _        __   __
 300   1                           //CLK __|0|_|1|_ ..._|31|_|32|_____
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 6   

 301   1                           //   _   __  __           ___  _____
 302   1                           //     \/  \/D0\ ...    \/D31\/
 303   1                           //I/O _/\__/\__/        /\___/
 304   1          
 305   1          temp = ReadByte();
 306   1          temp = ReadByte();
 307   1          temp = ReadByte();
 308   1          temp = ReadByte();   //¿Õ¶Á 32Bit (4Byte)
 309   1          IC_CLK_0;         //     __   __  IC sets I/O to state H
 310   1          Delay5us();         //CLK_|31|_|32|______________
 311   1          IC_IO_1;          //     __   ___  ____________
 312   1          _nop_();             //     30 \/ 31\/
 313   1          IC_CLK_0;          //I/O  __ /\___/
 314   1          Delay5us();
 315   1          
 316   1      }
 317          /*********************************************************************  
 318          
 319          º¯ Êı Ãû: BreakOperate()
 320          ¹¦    ÄÜ: XZ8802 ²Ù×÷ÖĞÖ¹
 321          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 322          µ÷    ÓÃ: 
 323          È«¾Ö±äÁ¿:
 324          Èë¿Ú²ÎÊı: ÎŞ
 325          ³ö¿Ú²ÎÊı£ºÎŞ
 326          ·µ »Ø Öµ: uchar
 327          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 328          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 329          ***********************************************************************/
 330          /*
 331          void BreakOperate(void)
 332          {
 333                   
 334                   IC_CLK_0;
 335               //ÈçMCU²»ÊÇ51ÏµÁĞ,ĞëÔÚ´Ë´¦ÉèÖÃMCUµÄIC_IO·½ÏòÎªÊäÈë!!       //0115  
 336           
 337               IC_RST_0;
 338               IC_IO_0;
 339               Delay5us();
 340               IC_RST_1;
 341               IC_IO_1;
 342               Delay5us();
 343               IC_RST_0;
 344               Delay5us();    
 345               IC_CLK_1;  //1212
 346               Delay5us();        //1212
 347               IC_CLK_0;  //1212
 348               Delay5us();        //1212
 349               IC_CLK_1;  //1215
 350               Delay5us();        //1215
 351               IC_CLK_0;  //1215
 352               Delay5us();        //1215
 353          }
 354          */
 355          /*********************************************************************  
 356          
 357          º¯ Êı Ãû: ReadByte()
 358          ¹¦    ÄÜ: ´ÓXZ8802¶ÁÒ»¸ö×Ö½Ú
 359          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 360          µ÷    ÓÃ: 
 361          È«¾Ö±äÁ¿:
 362          Èë¿Ú²ÎÊı: ÎŞ
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 7   

 363          ³ö¿Ú²ÎÊı£ºÎŞ
 364          ·µ »Ø Öµ: uchar
 365          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 366          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 367          ***********************************************************************/
 368          uchar ReadByte(void)
 369          {
 370   1          uchar i,ch;
 371   1          ch = 0;
 372   1              SFRPAGE = CONFIG_PAGE;  
 373   1          for (i = 8; i > 0; i--)
 374   1          {
 375   2              IC_CLK_0;
 376   2              ch = ch >> 1;           //´ÓµÍÎ»¶ÁÆğ    
 377   2              if((P7&(0x04))==0x04)
 378   2                  ch |= 0x80;
 379   2              Delay5us();     
 380   2              IC_CLK_1;
 381   2              Delay5us();
 382   2          }
 383   1              
 384   1          return ch;
 385   1      }
 386          /*********************************************************************  
 387          
 388          º¯ Êı Ãû: WriteByte()
 389          ¹¦    ÄÜ: ÍùXZ8802Ğ´Ò»¸ö×Ö½Ú
 390          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 391          µ÷    ÓÃ: 
 392          È«¾Ö±äÁ¿:
 393          Èë¿Ú²ÎÊı: uchar
 394          ³ö¿Ú²ÎÊı£ºÎŞ
 395          ·µ »Ø Öµ: ÎŞ
 396          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 397          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 398          ***********************************************************************/
 399          void WriteByte(uchar ch)
 400          {
 401   1          uchar i;
 402   1              SFRPAGE = CONFIG_PAGE;
 403   1          for(i = 8; i > 0; i--)
 404   1          {
 405   2              IC_CLK_0;
 406   2               if(ch & 0x01)
 407   2                              {IC_IO_1;}
 408   2                      else 
 409   2                              IC_IO_0;        
 410   2              Delay5us();
 411   2              IC_CLK_1;
 412   2              Delay10us();
 413   2              ch = ch >> 1;                 //ÓÒÒÆÒ»Î»
 414   2          }
 415   1      
 416   1      }
 417          /*********************************************************************  
 418          
 419          º¯ Êı Ãû: ReadMode()
 420          ¹¦    ÄÜ: Á¬ĞøÊäÈëi(=<255)¸ö×Ö½Ú,´æ·Åµ½ÒÔpt¿ªÍ·µÄÄÚ²¿µ¥ÔªÖĞ,±ØĞëÔÚÄ³Ò»¶ÁÊı¾İÃüÁîÄ£Ê½Ö®ºóÊ¹ÓÃ
 421          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 422          µ÷    ÓÃ: 
 423          È«¾Ö±äÁ¿:
 424          Èë¿Ú²ÎÊı: pt: ÆğÊ¼µØÖ·, count: Êı¾İ¸öÊı
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 8   

 425          ³ö¿Ú²ÎÊı£ºÎŞ
 426          ·µ »Ø Öµ: ÎŞ
 427          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 428          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º
 429          *********************************************************************/
 430          void ReadMode(uchar idata *pt,uchar count)
 431          {
 432   1          Delay5us();                                                 //0217
 433   1              SFRPAGE = CONFIG_PAGE;
 434   1          IC_CLK_0;       
 435   1          Delay5us(); //0115
 436   1          do
 437   1          {
 438   2              *pt = ReadByte();    //¶ÁÈëÒ»¸ö×Ö½Ú
 439   2              pt++;                //Ö¸Õë¼ÓÒ»
 440   2          }while(--count);             //¼ÆÊıÆ÷¼õÒ»,ÅĞ¶Ï
 441   1          IC_CLK_0;   //0115
 442   1      }
 443          /*********************************************************************  
 444          
 445          º¯ Êı Ãû: ProcessMode()
 446          ¹¦    ÄÜ: ´¦ÀíÄ£Ê½,¿ªÊ¼´¦ÀíÄ£Ê½ºó£¬XZ8802½«ÊäÈë¿ÚÀ­µÍ£¬´¦ÀíÍêºóÊäÈë¿Ú±ä³É¸ßµçÆ½
 447          Ëµ    Ã÷: (ÄÚ²¿º¯Êı)
 448          µ÷    ÓÃ: 
 449          È«¾Ö±äÁ¿:
 450          Èë¿Ú²ÎÊı: ÎŞ
 451          ³ö¿Ú²ÎÊı£ºÎŞ
 452          ·µ »Ø Öµ: ÎŞ
 453          Éè    ¼Æ£ºHentor                   ÈÕÆÚ£º2005-03-18
 454          ĞŞ    ¸Ä£º                             ÈÕÆÚ£º2006-08-10
 455          *********************************************************************/
 456          void ProcessMode(void)
 457          {
 458   1          uint i;
 459   1          Delay5us();                                                 //0217
 460   1              SFRPAGE = CONFIG_PAGE;
 461   1          IC_CLK_0;
 462   1          Delay5us();  //0115 
 463   1          IC_IO_0;
 464   1          for (i = 255; i > 0; i--)
 465   1          {
 466   2              IC_CLK_1;
 467   2              Delay5us();
 468   2              Delay10us();
 469   2              IC_CLK_0;
 470   2              Delay5us();
 471   2              Delay10us();
 472   2          }
 473   1          IC_IO_1;//2006-08-10
 474   1      }
 475          
 476          /******************************************************************** 
 477          
 478          º¯ Êı Ãû£ºDelay10us()
 479          ¹¦    ÄÜ£ºÑÓÊ±10Î¢Ãë£¨°üÀ¨µ÷ÓÃºÍ·µ»ØµÄÊ±¼ä£©,f = 100Mhz //11.0592Mhz
 480          Ëµ    Ã÷£ºÇë¸ù¾İÊµ¼ÊÊ¹ÓÃµÄCPUÖ÷Æµµ÷Õû¿ÕÖ¸ÁîÑ­»·³£Êı
 481          µ÷    ÓÃ£º
 482          Èë¿Ú²ÎÊı£ºÎŞ
 483          ³ö¿Ú²ÎÊı£ºÎŞ
 484          ·µ »Ø Öµ£ºÎŞ  
 485          Éè    ¼Æ£ºHentor           ÈÕ    ÆÚ£º2005-03-18
 486          ĞŞ    ¸Ä£º                     ÈÕ    ÆÚ£º 2006-08-10
C51 COMPILER V9.00   XZ_8802                                                               03/17/2016 15:11:11 PAGE 9   

 487          ***********************************************************************/
 488          //2006-08-10
 489           void Delay10us(void)  
 490          { 
 491   1         unsigned  int  i; 
 492   1              for(i=0;i<200;i++)  
 493   1              _nop_();
 494   1      }
 495          /******************************************************************** 
 496          
 497          º¯ Êı Ãû: Delay5us()
 498          ¹¦    ÄÜ£ºÑÓÊ±5Î¢Ãë£¨°üÀ¨µ÷ÓÃºÍ·µ»ØµÄÊ±¼ä£©,f = 100Mhz
 499          Ëµ    Ã÷£ºÇë¸ù¾İÊµ¼ÊÊ¹ÓÃµÄCPUÖ÷Æµµ÷Õû¿ÕÖ¸ÁîÑ­»·³£Êı
 500          µ÷    ÓÃ£º
 501          Èë¿Ú²ÎÊı£ºÎŞ
 502          ³ö¿Ú²ÎÊı£ºÎŞ
 503          ·µ »Ø Öµ£ºÎŞ  
 504          Éè    ¼Æ£ºHentor           ÈÕ    ÆÚ£º2005-03-18
 505          ĞŞ    ¸Ä£º                     ÈÕ    ÆÚ£º2006-08-10 
 506          ***********************************************************************/
 507          //2006-08-10
 508          void Delay5us(void)  
 509          { 
 510   1         unsigned  int  i; 
 511   1              for(i=0;i<100;i++)  
 512   1              _nop_();
 513   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    999    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =     25    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =      8    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
